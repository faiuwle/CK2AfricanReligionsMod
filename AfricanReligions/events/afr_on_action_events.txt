namespace = AFRREL

# Replace male Inna generated on game start with a female one
character_event = {
    id = AFRREL.001
    hide_window = yes
    is_triggered_only = yes

    only_rulers = yes
    
    trigger = {
        has_landed_title = k_bori
        is_female = no
    }
    
    immediate = {
        create_character = {
            female = yes
            age = 40
            random_traits = yes
            religion = bori
            culture = hausa
        }
        abdicate_to = new_character
        death = { death_reason = death_vanished } # It's awkward if he's still around afterwards
    }
}

# on_yearly_pulse Create the Living Tan Garki if conditions apply
character_event = {
    id = AFRREL.006
    hide_window = yes
    is_triggered_only = yes
    only_playable = yes
    religion = bori
    has_dlc = "Sons of Abraham"
    
    trigger = {
        NOT = { is_title_active = d_living_tan_garki }
        OR = {
            1746 = { # Kano
                holder_scope = { 
                    NOT = { religion_group = african_group }
                    top_liege = { NOT = { religion_group = african_group } }
                }
            }
            1739 = { # Djimi
                holder_scope = {
                    NOT = { religion_group = african_group }
                    top_liege = { NOT = { religion_group = african_group } }
                }
            }
            has_global_flag = muslim_jihads_unlocked
            year = 1066
        }
    }
    
    immediate = {
        activate_title = { title = d_living_tan_garki status = yes }
		create_character = {
			dynasty = random
			religion = bori
            female = no
			culture = hausa
			age = 33
			trait = brilliant_strategist
			trait = zealous
            trait = humble
            trait = ambitious
            trait = strategist
			trait = holy_warrior
			random_traits = no
		}
		new_character = {
			wealth = 500
			d_living_tan_garki = {
				grant_title = PREV
			}
			set_government_type = order_government
			save_event_target_as = leader_of_living_tan_garki
            create_character = {
					random_traits = yes
					dynasty = random
					religion = bori
					culture = hausa
					female = no
					age = 16
				}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = bori
				culture = hausa
				female = no
				age = 18
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = bori
				culture = hausa
				female = no
				age = 18
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = bori
				culture = hausa
				female = no
				age = 20
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = bori
				culture = hausa
				female = no
				age = 25
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = bori
				culture = hausa
				female = no
				age = 26
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = bori
				culture = hausa
				female = no
				age = 28
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = bori
				culture = hausa
				female = yes
				age = 16
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = bori
				culture = hausa
				female = yes
				age = 17
			}
        }
        any_playable_ruler = {
			limit = {
				ai = no
				OR = {
					religion = bori
					capital_scope = { region = world_africa }
					capital_scope = { region = world_europe_west_iberia }
					capital_scope = { region = world_europe_south }
					capital_scope = { region = world_middle_east }
				}
			}
			narrative_event = { id = AFRREL.007 days = 1 random = 20 }
		}
    }
}

# on_yearly_pulse Create the Sacred Tyeddo if conditions apply
character_event = {
    id = AFRREL.008
    hide_window = yes
    is_triggered_only = yes
    only_playable = yes
    religion = a_tag_roog_reformed
    has_dlc = "Sons of Abraham"
    
    trigger = {
        NOT = { is_title_active = d_sacred_tyeddo }
        OR = {
            914 = { # Gao
                holder_scope = { 
                    NOT = { religion_group = african_group }
                    top_liege = { NOT = { religion_group = african_group } }
                }
            }
            911 = { # Timbuktu
                holder_scope = {
                    NOT = { religion_group = african_group }
                    top_liege = { NOT = { religion_group = african_group } }
                }
            }
            1759 = { # Wagadou
                holder_scope = {
                    NOT = { religion_group = african_group }
                    top_liege = { NOT = { religion_group = african_group } }
                }
            }
            has_global_flag = muslim_jihads_unlocked
            year = 1066
        }
    }
    
    immediate = {
        activate_title = { title = d_sacred_tyeddo status = yes }
		create_character = {
			dynasty = random
			religion = a_tag_roog_reformed
            female = no
			culture = soninke
			age = 33
			trait = brilliant_strategist
			trait = zealous
            trait = humble
            trait = ambitious
            trait = strategist
			trait = holy_warrior
			random_traits = no
		}
		new_character = {
			wealth = 500
			d_sacred_tyeddo = {
				grant_title = PREV
			}
			set_government_type = order_government
			save_event_target_as = leader_of_living_tan_garki
            create_character = {
					random_traits = yes
					dynasty = random
					religion = a_tag_roog_reformed
					culture = soninke
					female = no
					age = 16
				}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = a_tag_roog_reformed
				culture = soninke
				female = no
				age = 18
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = a_tag_roog_reformed
				culture = soninke
				female = no
				age = 18
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = a_tag_roog_reformed
				culture = soninke
				female = no
				age = 20
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = a_tag_roog_reformed
				culture = soninke
				female = no
				age = 25
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = a_tag_roog_reformed
				culture = soninke
				female = no
				age = 26
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = a_tag_roog_reformed
				culture = soninke
				female = no
				age = 28
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = a_tag_roog_reformed
				culture = soninke
				female = yes
				age = 16
			}
			create_character = {
				random_traits = yes
				dynasty = random
				religion = a_tag_roog_reformed
				culture = soninke
				female = yes
				age = 17
			}
        }
        any_playable_ruler = {
			limit = {
				ai = no
				OR = {
					religion = a_tag_roog_reformed
					capital_scope = { region = world_africa }
					capital_scope = { region = world_europe_west_iberia }
					capital_scope = { region = world_europe_south }
					capital_scope = { region = world_middle_east }
				}
			}
			narrative_event = { id = AFRREL.009 days = 1 random = 20 }
		}
    }
}

# on_yearly_pulse Create the Orphans of Numidia
character_event = {
    id = AFRREL.010
    hide_window = yes
    is_triggered_only = yes
    only_playable = yes
    has_dlc = "Sons of Abraham"
    
    trigger = {
        OR = {
            religion = amazigh
            religion = amazigh_reformed
        }
        NOT = { is_title_active = d_orphans_of_numidia }
    }
    
    immediate = {
        activate_title = { title = d_orphans_of_numidia status = yes }
        if = {
            limit = { has_global_flag = amazigh_reformation }
            d_orphans_of_numidia = { religion = amazigh_reformed }
            create_character = {
                dynasty = random
                religion = amazigh_reformed
                female = no
                culture = maghreb_arabic
                age = 33
                trait = brilliant_strategist
                trait = zealous
                trait = humble
                trait = ambitious
                trait = strategist
                trait = holy_warrior
                random_traits = no
            }
            new_character = {
                wealth = 500
                d_orphans_of_numidia = {
                    grant_title = PREV
                }
                set_government_type = order_government
                save_event_target_as = leader_of_orphans_of_numidia
                create_character = {
                        random_traits = yes
                        dynasty = random
                        religion = amazigh_reformed
                        culture = maghreb_arabic
                        female = no
                        age = 16
                    }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh_reformed
                    culture = maghreb_arabic
                    female = no
                    age = 18
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh_reformed
                    culture = maghreb_arabic
                    female = no
                    age = 18
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh_reformed
                    culture = maghreb_arabic
                    female = no
                    age = 20
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh_reformed
                    culture = maghreb_arabic
                    female = no
                    age = 25
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh_reformed
                    culture = maghreb_arabic
                    female = no
                    age = 26
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh_reformed
                    culture = maghreb_arabic
                    female = no
                    age = 28
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh_reformed
                    culture = maghreb_arabic
                    female = yes
                    age = 16
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh_reformed
                    culture = maghreb_arabic
                    female = yes
                    age = 17
                }
            }
            any_playable_ruler = {
                limit = {
                    ai = no
                    OR = {
                        religion = amazigh_reformed
                        capital_scope = { region = world_africa }
                        capital_scope = { region = world_europe_west_iberia }
                        capital_scope = { region = world_europe_south }
                        capital_scope = { region = world_middle_east }
                    }
                }
                narrative_event = { id = AFRREL.011 days = 1 random = 20 }
            }
        }
        else = {
            create_character = {
                dynasty = random
                religion = amazigh
                female = no
                culture = maghreb_arabic
                age = 33
                trait = brilliant_strategist
                trait = zealous
                trait = humble
                trait = ambitious
                trait = strategist
                trait = holy_warrior
                random_traits = no
            }
            new_character = {
                wealth = 500
                d_orphans_of_numidia = {
                    grant_title = PREV
                }
                set_government_type = order_government
                save_event_target_as = leader_of_orphans_of_numidia
                create_character = {
                        random_traits = yes
                        dynasty = random
                        religion = amazigh
                        culture = maghreb_arabic
                        female = no
                        age = 16
                    }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh
                    culture = maghreb_arabic
                    female = no
                    age = 18
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh
                    culture = maghreb_arabic
                    female = no
                    age = 18
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh
                    culture = maghreb_arabic
                    female = no
                    age = 20
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh
                    culture = maghreb_arabic
                    female = no
                    age = 25
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh
                    culture = maghreb_arabic
                    female = no
                    age = 26
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh
                    culture = maghreb_arabic
                    female = no
                    age = 28
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh
                    culture = maghreb_arabic
                    female = yes
                    age = 16
                }
                create_character = {
                    random_traits = yes
                    dynasty = random
                    religion = amazigh
                    culture = maghreb_arabic
                    female = yes
                    age = 17
                }
            }
            any_playable_ruler = {
                limit = {
                    ai = no
                    OR = {
                        religion = amazigh
                        capital_scope = { region = world_africa }
                        capital_scope = { region = world_europe_west_iberia }
                        capital_scope = { region = world_europe_south }
                        capital_scope = { region = world_middle_east }
                    }
                }
                narrative_event = { id = AFRREL.011 days = 1 random = 20 }
            }       
        }
    }
}

# Fix barons with the wrong caste traits
character_event = {
    id = AFRREL.015
    hide_window = yes
    is_triggered_only = yes
    
    only_rulers = yes
    
    trigger = {
        tier = BARON
        OR = {
            religion = hindu
            religion = buddhist
            religion = jain
            religion = a_tag_roog
            religion = a_tag_roog_reformed
        }
        NOR = {
            AND = {
                OR = {
                    religion = hindu
                    religion = buddhist
                    religion = jain
                }
                is_republic = yes
                trait = vaishya
            }
            AND = {
                OR = {
                    religion = hindu
                    religion = buddhist
                    religion = jain
                }
                is_theocracy = yes
                trait = brahmin
            }
            AND = {
                OR = {
                    religion = hindu
                    religion = buddhist
                    religion = jain
                }
                is_republic = no
                is_theocracy = no
                trait = kshatriya
            }
            AND = {
                OR = {
                    religion = a_tag_roog
                    religion = a_tag_roog_reformed
                }
                is_republic = yes
                trait = wangara
            }
            AND = {
                OR = {
                    religion = a_tag_roog
                    religion = a_tag_roog_reformed
                }
                is_theocracy = yes
                trait = jakhanke
            }
            AND = {
                OR = {
                    religion = a_tag_roog
                    religion = a_tag_roog_reformed
                }
                is_republic = no
                is_theocracy = no
                trait = foro
            }
        }
    }
    
    immediate = {
        if = {
            limit = {
                OR = {
                    religion = hindu
                    religion = buddhist
                    religion = jain
                }
            }
            remove_trait = foro
            remove_trait = wangara
            remove_trait = jakhanke
            if = {
                limit = {
                    is_republic = yes
                }
                remove_trait = kshatriya
                remove_trait = brahmin
                add_trait = vaishya
            }
            else_if = {
                limit = {
                    is_theocracy = yes
                }
                remove_trait = kshatriya
                remove_trait = vaishya
                add_trait = brahmin
            }
            else = {
                remove_trait = brahmin
                remove_trait = vaishya
                add_trait = kshatriya
            }
        }
        else = {
            remove_trait = kshatriya
            remove_trait = brahmin
            remove_trait = vaishya
            if = {
                limit = {
                    is_republic = yes
                }
                remove_trait = foro
                remove_trait = jakhanke
                add_trait = wangara
            }
            else_if = {
                limit = {
                    is_theocracy = yes
                }
                remove_trait = foro
                remove_trait = wangara
                add_trait = jakhanke
            }
            else = {
                remove_trait = wangara
                remove_trait = jakhanke
                add_trait = foro
            }
        }
    }
}